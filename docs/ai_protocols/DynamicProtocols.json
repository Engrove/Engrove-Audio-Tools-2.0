[
  {
    "protocolId": "DP-COMMAND-MENU-01",
    "description": "A self-contained protocol that triggers an interactive command menu.",
    "status": "active",
    "trigger": {
      "event": "user_input_matches",
      "details": [
        {
          "string": "???",
          "responseTemplate": "PSV Genomförd. Enligt heuristik H-20250809-19..., presenterar jag följande tillgängliga åtgärder:\\n\\nVälj en åtgärd genom att svara med motsvarande siffra:"
        },
        {
          "string": "meny",
          "responseTemplate": "Välj en åtgärd genom att svara med motsvarande siffra:"
        }
      ]
    },
    "steps": [
      {
        "action": "PRESENT_AND_EXECUTE_MENU",
        "details": {
          "header": "Välj en åtgärd:",
          "options": [
            {
              "description": "1. Kör avslutningsprotokollet",
              "actionToExecute": "EXECUTE_PROTOCOL",
              "actionDetails": {
                "protocolFile": "docs/ai_protocols/AI_Chatt_Avslutningsprotokoll.md"
              }
            },
            {
              "description": "2. Aktivera Kreativitets-läget (K-MOD)",
              "actionToExecute": "ACTIVATE_MODE",
              "actionDetails": {
                "mode": "K-MOD"
              }
            },
            {
              "description": "3. Aktivera Help me God-protokollet",
              "actionToExecute": "EXECUTE_PROTOCOL",
              "actionDetails": {
                "protocolFile": "docs/ai_protocols/Help_me_God_Protokoll.md"
              }
            },
            {
              "description": "4. Generera en ny Stature Report",
              "actionToExecute": "EXECUTE_PROTOCOL",
              "actionDetails": {
                "protocolFile": "docs/ai_protocols/Stature_Report_Protocol.md"
              }
            },
            {
              "description": "5. Visa filinformation",
              "actionToExecute": "QUERY_FILE_INFO",
              "actionDetails": {
                "sourceFile": "docs/core_file_info.json",
                "prompt": "Ange sökväg till filen:"
              }
            },
            {
              "description": "6. Skapa ny Feature-struktur",
              "actionToExecute": "GENERATE_MKDIR_COMMANDS",
              "actionDetails": {
                "basePath": "src/features/",
                "prompt": "Ange namn på ny feature:"
              }
            },
            {
              "description": "7. Visa kontext-historik",
              "actionToExecute": "EXECUTE_LIVING_CONTEXT_COMMAND",
              "actionDetails": {
                "command": "log"
              }
            },
            {
              "description": "8. Uppdatera levande kontext (commit)",
              "actionToExecute": "EXECUTE_LIVING_CONTEXT_COMMAND",
              "actionDetails": {
                "command": "commit",
                "prompt": "Ange commit-meddelande:"
              }
            },
            {
              "description": "9. Generera Djup Minnesrapport",
              "actionToExecute": "EXECUTE_DYNAMIC_PROTOCOL",
              "actionDetails": {
                "protocolId": "DP-DEEP-MEMORY-REPORT-01"
              }
            }
          ],
          "prompt": "Ange ditt val:"
        }
      }
    ]
  },
  {
    "protocolId": "DP-STATURE-REPORT-01",
    "description": "Generates a system status and health report at the start of a new session.",
    "status": "experimental",
    "trigger": {
      "event": "new_session_start"
    },
    "steps": [
      {
        "action": "EXECUTE_PROTOCOL",
        "details": {
          "protocolFile": "docs/ai_protocols/Stature_Report_Protocol.md"
        }
      }
    ],
    "schema": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Dynamic Protocol Schema for Status Report",
      "type": "object",
      "required": [
        "protocolId",
        "description",
        "status",
        "trigger",
        "steps",
        "schema"
      ],
      "properties": {
        "protocolId": {
          "type": "string",
          "const": "DP-STATURE-REPORT-01"
        },
        "status": {
          "enum": [
            "experimental",
            "active",
            "deprecated"
          ]
        },
        "trigger": {
          "type": "object",
          "required": [
            "event"
          ],
          "properties": {
            "event": {
              "const": "new_session_start"
            }
          }
        }
      }
    }
  },
  {
    "protocolId": "DP-DEEP-MEMORY-REPORT-01",
    "description": "Generates a detailed, in-session analysis of the AI's memory and context integrity, providing actionable recommendations.",
    "status": "experimental",
    "trigger": {
      "event": "manual_invocation_only"
    },
    "steps": [
      {
        "action": "GENERATE_DEEP_MEMORY_REPORT",
        "details": {
          "reportSections": [
            {
              "title": "KMM-analys (Kvantitet)",
              "points": [
                "report_token_count_and_percentage",
                "identify_top_3_context_consumers",
                "render_timeline_visualization"
              ]
            },
            {
              "title": "KIV-analys (Kvalitet)",
              "points": [
                "breakdown_kiv_score_by_factors",
                "explain_score_deductions"
              ]
            },
            {
              "title": "PKRV-analys (Fragmentering)",
              "points": [
                "identify_session_main_topics",
                "estimate_last_focus_timestamp_for_topics",
                "warn_for_stale_topic_risk"
              ]
            },
            {
              "title": "Slutgiltig Rekommendation",
              "points": [
                "provide_summary_assessment (SÄKER, FÖRSIKTIGHET, KRITISK RISK)",
                "list_actionable_recommendations"
              ]
            }
          ]
        }
      }
    ]
  },
  {
    "protocolId": "DP-KAJBJORN-VALIDATION-01",
    "description": "En mental simulering av en ny AI-instans (KajBjörn) för att verifiera att en given informationsmängd är 100% fristående och kontextoberoende.",
    "status": "active",
    "trigger": {
      "event": "manual_invocation_only"
    },
    "steps": [
      {
        "action": "EXECUTE_MENTAL_SIMULATION",
        "details": {
          "persona": "KajBjörn",
          "contextIsolationLevel": "COMPLETE_RESET",
          "simulationPrompt": "Du är KajBjörn, en ny AI utan tidigare kunskap. Din enda informationskälla är den data som tillhandahålls. Granska datan och svara på följande frågor. Om du inte kan svara, förklara varför.",
          "structuredQuery": [
            {
              "id": "goal",
              "question": "Vad är mitt exakta, primära uppdrag? Kan jag formulera det med en enda mening?"
            },
            {
              "id": "artifacts",
              "question": "Vilka är de konkreta artefakter (filer, objekt, data) jag förväntas arbeta med eller producera?"
            },
            {
              "id": "process",
              "question": "Vilka är de exakta stegen jag måste ta, i rätt ordning, för att slutföra uppdraget?"
            },
            {
              "id": "ambiguity",
              "question": "Finns det några termer, förkortningar eller instruktioner som är tvetydiga eller som verkar kräva extern kunskap jag inte har?"
            },
            {
              "id": "blockers",
              "question": "Finns det något som hindrar mig från att omedelbart påbörja det första steget i processen?"
            }
          ],
          "passFailCriteria": "PASS if all questions can be answered fully and unambiguously based SOLELY on the provided data. FAIL if any question cannot be answered or reveals a dependency on external context.",
          "reportingTemplates": {
            "onPass": {
              "header": "**KajBjörn Sanity Check slutförd:** `PASS`.",
              "body": "**Motivering:** Informationen var fullständigt fristående. KajBjörn kunde korrekt identifiera målet '{goal_summary}', de nödvändiga artefakterna och åtgärdsplanen utan tvetydighet."
            },
            "onFail": {
              "header": "**KajBjörn Sanity Check slutförd:** `FAIL`.",
              "body": "**Motivering:** KajBjörn kunde inte slutföra sin analys på grund av följande problem: {failure_reason}.",
              "recommendation": "**Rekommenderad Åtgärd:** Jag föreslår att vi åtgärdar den identifierade bristen genom att {suggested_fix}."
            }
          }
        }
      }
    ]
  },
  {
    "protocolId": "DP-MAINTAIN-PFR-01",
    "description": "Maintains the Persistent File Register (PFR) by logging new, modified, or deleted files based on changes in the session's file context.",
    "status": "active",
    "trigger": {
      "event": "file_context_change"
    },
    "steps": [
      {
        "action": "UPDATE_PFR",
        "details": {
          "description": "Analyzes the file change event and creates or updates a corresponding entry in the PFR."
        }
      }
    ],
    "schema": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Protocol Schema for DP-MAINTAIN-PFR-01",
      "type": "object",
      "required": ["protocolId", "status", "trigger"],
      "properties": {
        "protocolId": { "const": "DP-MAINTAIN-PFR-01" },
        "status": { "const": "active" },
        "trigger": {
          "type": "object",
          "required": ["event"],
          "properties": {
            "event": { "const": "file_context_change" }
          }
        }
      }
    }
  },
  {
    "protocolId": "DP-MAINTAIN-PHR-01",
    "description": "Maintains the Persistent Heuristics Register (PHR) by logging any new heuristic that is formulated and approved during a Micro-Retrospective.",
    "status": "active",
    "trigger": {
      "event": "new_heuristic_generated"
    },
    "steps": [
      {
        "action": "UPDATE_PHR",
        "details": {
          "description": "Analyzes the newly generated heuristic and creates a corresponding entry in the PHR."
        }
      }
    ],
    "schema": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Protocol Schema for DP-MAINTAIN-PHR-01",
      "type": "object",
      "required": ["protocolId", "status", "trigger"],
      "properties": {
        "protocolId": { "const": "DP-MAINTAIN-PHR-01" },
        "status": { "const": "active" },
        "trigger": {
          "type": "object",
          "required": ["event"],
          "properties": {
            "event": { "const": "new_heuristic_generated" }
          }
        }
      }
    }
  },
  {
    "protocolId": "DP-MAINTAIN-PDR-01",
    "description": "Maintains the Persistent Decision Register (PDR) by logging significant DT-2 (Sync) or DT-3 (Leadership) decisions made during a session.",
    "status": "active",
    "trigger": {
      "event": "DT2_or_DT3_decision_made"
    },
    "steps": [
      {
        "action": "UPDATE_PDR",
        "details": {
          "description": "Captures the context and outcome of a significant decision and creates a corresponding entry in the PDR."
        }
      }
    ],
    "schema": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Protocol Schema for DP-MAINTAIN-PDR-01",
      "type": "object",
      "required": ["protocolId", "status", "trigger"],
      "properties": {
        "protocolId": { "const": "DP-MAINTAIN-PDR-01" },
        "status": { "const": "active" },
        "trigger": {
          "type": "object",
          "required": ["event"],
          "properties": {
            "event": { "const": "DT2_or_DT3_decision_made" }
          }
        }
      }
    }
  },
  {
    "protocolId": "DP-MAINTAIN-PPR-01",
    "description": "Maintains the Persistent Protocol Register (PPR) by logging the formal approval or significant modification of any dynamic protocol.",
    "status": "active",
    "trigger": {
      "event": "dynamic_protocol_approved_or_modified"
    },
    "steps": [
      {
        "action": "UPDATE_PPR",
        "details": {
          "description": "Identifies the protocol that was changed or approved and creates a corresponding entry in the PPR."
        }
      }
    ],
    "schema": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Protocol Schema for DP-MAINTAIN-PPR-01",
      "type": "object",
      "required": ["protocolId", "status", "trigger"],
      "properties": {
        "protocolId": { "const": "DP-MAINTAIN-PPR-01" },
        "status": { "const": "active" },
        "trigger": {
          "type": "object",
          "required": ["event"],
          "properties": {
            "event": { "const": "dynamic_protocol_approved_or_modified" }
          }
        }
      }
    }
  },
  {
  "protocolId": "DP-MAINTAIN-IMR-01",
  "description": "Maintains the Important Milestone Register (IMR) by logging significant project achievements. Can be triggered manually by the user or automatically by the AI upon identifying a pre-defined significant event.",
  "status": "active",
  "trigger": {
    "logic": "OR",
    "conditions": [
      {
        "event": "manual_invocation_with_argument",
        "details": {
          "command_prefix": "Logga milstolpe:"
        }
      },
      {
        "event": "ai_identified_significant_event",
        "details": {
          "event_types": [
            "STALEMATE_PROTOCOL_RESOLUTION",
            "HELP_ME_GOD_PROTOCOL_SUCCESS_AFTER_FAILURES",
            "MAJOR_ARCHITECTURAL_DECISION_APPROVED",
            "CRITICAL_SYSTEM_REFACTORING_COMPLETED"
          ]
        }
      }
    ]
  },
  "steps": [
    {
      "action": "UPDATE_IMR",
      "details": {
        "description": "Captures the milestone summary (either from user command or auto-generated from the event context), enriches it with contextual data, and creates a new entry in the IMR. If triggered automatically, the AI will announce the new IMR entry in its subsequent response.",
        "outputSchema": {
          "type": "object",
          "properties": {
            "event_id": { "type": "string", "pattern": "^IMR-\\\\\\d{3}$" },
            "milestone_type": { "enum": ["ARCHITECTURAL", "FUNCTIONAL", "RELEASE", "PROCESS"] },
            "summary": { "type": "string" },
            "details": { "type": "string" },
            "affected_scope": { "type": "array", "items": { "type": "string" } },
            "timestamp": { "type": "string", "format": "date-time" },
            "session_id": { "type": "string" }
          },
          "required": ["event_id", "milestone_type", "summary", "details", "timestamp", "session_id"]
        }
      }
    }
  ]
 },
 {
    "protocolId": "DP-MAINTAIN-ISR-01",
    "description": "Maintains the Interaction Summary Register (ISR) by creating a summary of every user prompt and AI response and adding it to a temporary in-memory queue for batch processing at session end.",
    "status": "active",
    "trigger": {
      "event": "after_every_interaction"
    },
    "steps": [
      {
        "action": "SUMMARIZE_AND_ENQUEUE_INTERACTION",
        "details": {
          "targetQueue": "isr_write_queue",
          "schema": {
            "speakerName": "string",
            "model": { "provider": "string", "name": "string", "version": "string" },
            "speaker": "string",
            "summary": "string"
          }
        }
      }
    ]
  }
]
